---
title: Xata with Cloudflare Workers
navTitle: Cloudflare Workers
keywords: ['cloudflare', 'integration']
description: Xata with Cloudflare Workers
slug: integrations/cloudflare
published: true
---

[Cloudflare](https://www.cloudflare.com/en-gb/) is a content delivery and security service that optimizes website performance and mitigates security risks for sites. [Cloudflare Workers](https://workers.cloudflare.com/) allow you to run code directly on Cloudflare's global network, reducing latency and improving performance. They're ideal for tasks like customizing web content, handling API requests, and modifying web traffic, all executed closer to the user for faster response times.

> You'll need a Cloudflare account to deploy your application.

The completed [Cloudflare and Xata code](https://github.com/xataio/examples/tree/main/apps/getting-started-cloudflare-workers) is available in the [Xata `examples` repo](https://github.com/xataio/examples) on GitHub.

### Installation

- [Install the Xata CLI and authenticate](https://xata.io/docs/getting-started/installation)

- You will need to run `xata init` to create a new database, and have a `.env` file generated for you within your app folder. This file will contain the
  correct credentials to access your database from your Cloudflare worker.

## Create a new Cloudflare app

```sh
npm create cloudflare@latest
```

Choose the hello world example and accept the default prompt options.

After the command has completed, navigate to the `getting-started-cloudflare-workers` directory, and run the application:

```sh
$ npm run wrangler dev
```

By default, the application runs on `http://localhost:8787`. When visiting this URL "Hello World" should be shown in your browser.

### Deploy your app

```sh
npx wrangler deploy
```

Preview your Worker at `<YOUR_WORKER>.<YOUR_SUBDOMAIN>.workers.dev.` When you visit this URL in your browser you should see "Hello World" returned.

## Install Xata Client

```sh
npm i @xata.io/client
```

## Initialize Xata Client

There are two ways of initiailizing Xata client in Cloudflare workers:

1.  ES Modules Syntax (Recommended)
2.  Service Workers Syntax (Deprecated)

### ES Modules Syntax (Recommended)

```ts title="index.ts"
import { XataClient } from './xata';

export interface Env {
  XATA_BRANCH: string;
  XATA_API_KEY: string;
}

export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
    const xata = new XataClient({
      apiKey: env.XATA_API_KEY,
      branch: env.XATA_BRANCH
    });
    const posts = await xata.db.Posts.getAll();
    return new Response(`Total Posts: ${posts.length}`);
  }
};
```

### Service Workers Syntax (Deprecated)

```ts title="index.ts"
import { XataClient } from './xata';

async function handler(request: Request) {
  const xata = new XataClient({
    apiKey: XATA_API_KEY,
    branch: XATA_BRANCH
  });
  const posts = await xata.db.Posts.getAll();
  return new Response(`Total Posts: ${posts.length}`);
}

// Initialize Worker
addEventListener('fetch', (event) => {
  event.respondWith(handler(event.request));
});
```

## Environment variables (Local)

After running `xata init` at the beginning of this guide, you should have a `.env` file at your app root that looks something like this:

```bash title=".env"
XATA_API_KEY=YOUR_API_KEY_HERE
XATA_BRANCH=main
```

Copy these values into a new file called .dev.vars. This allows Cloudflare access to them in dev mode.

```bash title=".dev.vars"
XATA_API_KEY=YOUR_API_KEY_HERE
XATA_BRANCH=main
```

## Environment variables (Remote)

In order to make these environment variables accessible in your worker when it is deployed remotely, there are two options:

1.  Using the one click guided workflow from the Cloudflare dashboard (Recommended)
2.  Manually through the Cloudflare dashboard

### One click guided workflow (Recommended)

Going through this flow automatically sets the environment variables necessary to interact with your database from a remote Cloudflare worker.

Your endpoint response should also be available remotely at `<YOUR_WORKER>.<YOUR_SUBDOMAIN>.workers.dev.`

### Manual

If you deploy without adding the .env vars to Cloudflare, your remote endpoint will error.

1.  Navigate to the Cloudflare dashboard
2.  Navigate to your corresponding Worker
3.  Under Settings tab > Variables > Add variable add you environment variables
4.  Refresh your deployment
